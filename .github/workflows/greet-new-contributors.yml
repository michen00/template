name: greet-new-contributors

permissions:
  issues: write
  pull-requests: write

on:
  issues:
    types: [opened]
  pull_request:
    types: [opened]

jobs:
  greeting:
    runs-on: ubuntu-latest
    steps:
      - name: detect bot author
        id: bot-author-check
        uses: actions/github-script@v8
        with:
          result-encoding: string
          script: |
            const isBotUser = (user) => {
              if (!user) return false;
              if (user.type === 'Bot') return true;
              if (typeof user.login === 'string' && user.login.endsWith('[bot]')) return true;
              return false;
            };

            if (context.eventName === 'issues') {
              return isBotUser(context.payload.issue?.user) ? 'true' : 'false';
            }

            if (context.eventName === 'pull_request') {
              return isBotUser(context.payload.pull_request?.user) ? 'true' : 'false';
            }

            return 'false';

      - name: identify issue type
        if: steps.bot-author-check.outputs.result != 'true' && github.event_name == 'issues'
        id: check-labels
        uses: actions/github-script@v8
        with:
          result-encoding: string
          script: |
            const issue = context.payload.issue;
            if (!issue) {
              return "unknown";
            }
            const labels = issue.labels.map(label => label.name.toLowerCase());
            if (labels.includes("bug")) {
              return "bug";
            }
            if (labels.includes("enhancement") || labels.includes("feature-request")) {
              return "enhancement";
            }
            return "unknown";
      - name: greet bug reports
        if: steps.bot-author-check.outputs.result != 'true' && github.event_name == 'issues' && steps.check-labels.outputs.result == 'bug'
        uses: actions/first-interaction@v3
        with:
          issue_message: |
            ğŸ‰ Welcome to the `invisible-squiggles` community! ğŸ‰

            Thank you for taking the time to report this issue! ğŸ› Quality is important to us and we would never release anything with known defects, but unfortunately, you encountered something we didn't expect. Let's figure out what went wrong together so we can identify a remedy for it.

            A maintainer will be with you soon! Thank you for your cooperation ğŸ™
      - name: greet feature requests
        if: steps.bot-author-check.outputs.result != 'true' && github.event_name == 'issues' && steps.check-labels.outputs.result == 'enhancement'
        uses: actions/first-interaction@v3
        with:
          issue_message: |
            ğŸ‰ Welcome to the `invisible-squiggles` community! ğŸ‰

            Thank you for your feature request! ğŸš€ We love ideas that help improve this project. Your suggestion will be reviewed by a maintainer soon. If you have any additional thoughts, feel free to add them to this issue.

            Looking forward to making `invisible-squiggles` even better together! âœ¨

      - name: greet pull requests
        if: steps.bot-author-check.outputs.result != 'true' && github.event_name == 'pull_request'
        uses: actions/first-interaction@v3
        with:
          issue_message: |
            ğŸ‰ Welcome to the `invisible-squiggles` community! ğŸ‰

            Thank you for your contribution! We appreciate your time and effort in submitting this issue. A maintainer will review it soon. If you have any questions, feel free to ask!

            Thank you for your cooperation ğŸ™
          pr_message: |
            ğŸ‰ Welcome to the `invisible-squiggles` community! ğŸ‰

            Thank you for your contribution! We appreciate your time and effort in submitting this pull request. A maintainer will review it soon. If you have any questions, feel free to ask!

            Thank you for your cooperation ğŸ™
